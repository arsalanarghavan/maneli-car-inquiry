# 📊 سیستم گزارشات پیشرفته - Maneli Car Inquiry

## خلاصه

سیستم گزارشات پیشرفته یک ابزار جامع برای **نظارت**، **تحلیل** و **مدیریت** عملکرد سیستم استعلام خودرو است که به مدیران و کارشناسان کمک می‌کند تا:

✅ وضعیت کلی سیستم را در یک نگاه ببینند  
✅ عملکرد هر کارشناس را جداگانه ارزیابی کنند  
✅ روندها و الگوها را شناسایی کنند  
✅ تصمیمات داده‌محور بگیرند  

---

## 🎯 ویژگی‌های کلیدی

### 1. کارت‌های آماری تعاملی
- **9 کارت آماری** با اطلاعات کلیدی
- **به‌روزرسانی لحظه‌ای** با Ajax
- **انیمیشن‌های زیبا** برای جلب توجه
- **رنگ‌بندی هوشمند** برای تشخیص سریع

### 2. فیلترهای پیشرفته
- **8 بازه زمانی پیش‌فرض** + سفارشی
- **فیلتر بر اساس کارشناس**
- **فیلتر نوع استعلام** (نقدی/اقساطی)
- **فیلتر وضعیت** (تایید شده، رد شده، ...)

### 3. نمودارهای تحلیلی
- **نمودار خطی**: روند روزانه استعلام‌ها
- **نمودار دایره‌ای**: توزیع وضعیت‌ها
- **نمودار دونات**: نسبت نقدی به اقساطی
- **نمودار میله‌ای**: عملکرد ماهانه
- **نمودار مقایسه‌ای**: رتبه‌بندی کارشناسان

### 4. گزارشات جامع
- **گزارش کارشناسان**: آمار کامل هر کارشناس
- **جزئیات استعلام‌ها**: جدول تفصیلی با صفحه‌بندی
- **محصولات پرطرفدار**: رتبه‌بندی محصولات
- **صادرات CSV**: دانلود داده‌ها برای تحلیل

### 5. ویجت داشبورد
- **نمایش در صفحه اصلی** وردپرس
- **آمار 30 روز گذشته**
- **لینک‌های سریع** به بخش‌های مختلف
- **شخصی‌سازی برای کارشناسان**

---

## 🚀 نصب و راه‌اندازی

### پیش‌نیازها
- WordPress 5.0+
- PHP 7.4+
- WooCommerce 3.0+
- Maneli Car Inquiry Plugin (نسخه اصلی)

### مراحل نصب

سیستم گزارشات به صورت خودکار با پلاگین اصلی نصب می‌شود. پس از فعال‌سازی پلاگین:

1. وارد پنل مدیریت شوید
2. از منوی راست، گزینه **"استعلام نقدی"** را انتخاب کنید
3. روی **"📊 گزارشات"** کلیک کنید
4. سیستم گزارشات آماده استفاده است!

---

## 📖 راهنمای استفاده

### دسترسی به گزارشات

**مسیر منو:**  
`پنل ادمین > استعلام نقدی > 📊 گزارشات`

**یا از ویجت داشبورد:**  
`داشبورد وردپرس > ویجت "گزارشات پیشرفته" > دکمه "گزارشات کامل"`

### استفاده از فیلترها

#### انتخاب بازه زمانی:
1. از لیست کشویی یک بازه انتخاب کنید:
   - امروز
   - دیروز
   - هفته گذشته
   - **ماه گذشته** (پیش‌فرض)
   - 3 ماه گذشته
   - 6 ماه گذشته
   - سال گذشته
   - **سفارشی** (انتخاب دستی تاریخ)

2. اگر "سفارشی" را انتخاب کردید، تاریخ شروع و پایان را مشخص کنید

3. دکمه **"اعمال فیلتر"** را بزنید

#### فیلتر کارشناس:
برای مشاهده آمار یک کارشناس خاص:
1. از لیست "کارشناس" نام مورد نظر را انتخاب کنید
2. **"اعمال فیلتر"** را بزنید

### بررسی تب‌های مختلف

#### تب "نمای کلی"
- **کارت‌های آماری**: خلاصه عملکرد سیستم
- **نمودار روند**: مشاهده روند روزانه استعلام‌ها
- **محصولات پرطرفدار**: 10 محصول برتر

#### تب "گزارش کارشناسان"
- **جدول جامع**: آمار کامل همه کارشناسان
- **مقایسه عملکرد**: مشاهده بهترین کارشناس
- **تعداد مشتریان**: کل و جدید

#### تب "جزئیات استعلام‌ها"
- **جدول تفصیلی**: تمام استعلام‌ها با جزئیات
- **فیلترهای پیشرفته**: نوع و وضعیت
- **صفحه‌بندی**: مدیریت آسان داده‌های زیاد
- **دانلود CSV**: صادرات داده‌ها

#### تب "نمودارها"
- **4 نمودار تحلیلی** مختلف
- **تعاملی و زنده**
- **نمایش بصری** داده‌ها

### دانلود گزارش CSV

1. به تب **"جزئیات استعلام‌ها"** بروید
2. فیلترهای مورد نظر را اعمال کنید
3. دکمه **"⬇ دانلود CSV"** را بزنید
4. فایل CSV شامل تمام فیلدها دانلود می‌شود:
   - شناسه
   - تاریخ
   - نوع
   - نام مشتری
   - تلفن
   - کد ملی
   - محصول
   - وضعیت
   - مبلغ
   - کارشناس

---

## 🎨 رابط کاربری

### کارت‌های آماری

```
┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐
│  📊 کل استعلام‌ها   │  │  💰 استعلام نقدی    │  │  🧾 استعلام اقساطی  │
│      150            │  │      80             │  │      70             │
│  امروز: 5           │  │                     │  │                     │
└─────────────────────┘  └─────────────────────┘  └─────────────────────┘

┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐
│  ✅ تایید شده       │  │  ⏰ در انتظار       │  │  ❌ رد شده          │
│      90             │  │      25             │  │      20             │
└─────────────────────┘  └─────────────────────┘  └─────────────────────┘
```

### نمودارها

- **رنگ‌های متمایز** برای هر وضعیت
- **Tooltip** برای اطلاعات بیشتر
- **زوم و Pan** در نمودارهای خطی
- **کلیک روی Legend** برای مخفی کردن

---

## 🔧 پیکربندی پیشرفته

### برای توسعه‌دهندگان

#### استفاده از API

```php
// دریافت آمار کلی
$stats = Maneli_Reports_Dashboard::get_overall_statistics();

// دریافت آمار یک کارشناس
$expert_stats = Maneli_Reports_Dashboard::get_overall_statistics(
    '2025-01-01',
    '2025-01-31',
    123 // شناسه کارشناس
);

// محصولات پرطرفدار
$popular = Maneli_Reports_Dashboard::get_popular_products(null, null, null, 5);
```

برای مستندات کامل API به فایل **[REPORTS-API-DOCUMENTATION.md](REPORTS-API-DOCUMENTATION.md)** مراجعه کنید.

### ساخت شورت‌کد سفارشی

```php
function my_stats_shortcode() {
    $stats = Maneli_Reports_Dashboard::get_overall_statistics();
    return "کل استعلام‌ها: {$stats['total_inquiries']}";
}
add_shortcode('my_stats', 'my_stats_shortcode');

// استفاده: [my_stats]
```

### افزودن ویجت سفارشی

```php
wp_add_dashboard_widget(
    'my_custom_widget',
    'آمار سفارشی',
    function() {
        $stats = Maneli_Reports_Dashboard::get_overall_statistics();
        echo "تایید شده: {$stats['approved']}";
    }
);
```

---

## 📊 معیارهای کلیدی (KPIs)

سیستم گزارشات معیارهای زیر را پیگیری می‌کند:

### معیارهای حجم
- **کل استعلام‌ها**: تعداد کل درخواست‌های ثبت شده
- **استعلام نقدی**: درخواست‌های خرید نقدی
- **استعلام اقساطی**: درخواست‌های خرید اقساطی
- **استعلام‌های امروز**: تعداد درخواست‌های جدید

### معیارهای کیفیت
- **نرخ تایید**: درصد استعلام‌های تایید شده
- **نرخ رد**: درصد استعلام‌های رد شده
- **زمان پاسخ‌دهی**: میانگین زمان پردازش

### معیارهای مالی
- **درآمد کل**: مجموع درآمد از استعلام‌های تکمیل شده
- **میانگین درآمد**: درآمد به ازای هر استعلام
- **درآمد هر کارشناس**: توزیع درآمد

### معیارهای مشتری
- **تعداد مشتریان کل**: مشتریان یکتا
- **مشتریان جدید**: مشتریان جدید در بازه زمانی
- **نرخ بازگشت**: مشتریانی که دوباره مراجعه کرده‌اند

---

## 🔐 سطوح دسترسی

### مدیر سیستم (Administrator)
✅ دسترسی به همه گزارشات  
✅ مشاهده آمار تمام کارشناسان  
✅ دانلود CSV  
✅ تغییر فیلترها  

### کارشناس (Expert)
✅ مشاهده فقط آمار خود  
✅ دانلود CSV فقط استعلام‌های خود  
⛔ دسترسی به آمار کارشناسان دیگر  

### کاربر عادی (User)
⛔ بدون دسترسی به گزارشات  

---

## 🎯 موارد استفاده

### برای مدیران

#### 1. ارزیابی عملکرد
```
سوال: کدام کارشناس بیشترین استعلام را دارد؟
مسیر: تب "گزارش کارشناسان" > مرتب‌سازی بر اساس "کل استعلام‌ها"
```

#### 2. شناسایی روند
```
سوال: آیا استعلام‌ها در حال افزایش هستند؟
مسیر: تب "نمای کلی" > نمودار روند روزانه
```

#### 3. بهینه‌سازی منابع
```
سوال: کدام محصولات بیشترین تقاضا را دارند؟
مسیر: تب "نمای کلی" > محصولات پرطرفدار
```

### برای کارشناسان

#### 1. پیگیری عملکرد شخصی
```
مسیر: فیلتر کارشناس > انتخاب نام خود > اعمال فیلتر
```

#### 2. مدیریت مشتریان
```
مسیر: تب "جزئیات استعلام‌ها" > مشاهده لیست مشتریان
```

#### 3. برنامه‌ریزی پیگیری
```
مسیر: کارت "پیگیری آینده" > مشاهده تعداد پیگیری‌های برنامه‌ریزی شده
```

---

## 📱 سازگاری

### مرورگرها
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

### دستگاه‌ها
- ✅ Desktop (1920×1080+)
- ✅ Laptop (1366×768)
- ✅ Tablet (768×1024)
- ✅ Mobile (375×667)

### وردپرس
- ✅ WordPress 5.0 - 6.4+
- ✅ PHP 7.4 - 8.2
- ✅ MySQL 5.7+

---

## 🐛 عیب‌یابی

### مشکلات رایج

#### 1. گزارشات بارگذاری نمی‌شوند
```
راه‌حل:
1. Ctrl+F5 برای رفرش کامل
2. بررسی Console مرورگر (F12)
3. چک کردن دسترسی کاربر
```

#### 2. نمودارها نمایش داده نمی‌شوند
```
راه‌حل:
1. اطمینان از بارگذاری Chart.js
2. غیرفعال کردن موقت AdBlocker
3. بررسی خطاهای JavaScript
```

#### 3. CSV دانلود نمی‌شود
```
راه‌حل:
1. بررسی دسترسی Write در سرور
2. افزایش PHP Memory Limit
3. کاهش تعداد رکوردها با فیلتر
```

### لاگ‌ها

برای فعال‌سازی Debug:

```php
// در wp-config.php
define('WP_DEBUG', true);
define('WP_DEBUG_LOG', true);
define('WP_DEBUG_DISPLAY', false);
```

لاگ‌ها در `wp-content/debug.log` ذخیره می‌شوند.

---

## 📈 بهینه‌سازی عملکرد

### برای سرعت بهتر

1. **فعال‌سازی کش**:
```php
// استفاده از Object Cache
wp_cache_set('maneli_stats_30d', $stats, 'maneli', 3600);
```

2. **محدود کردن بازه زمانی**:
- از بازه‌های کوتاه‌تر استفاده کنید
- داده‌های قدیمی را آرشیو کنید

3. **ایندکس دیتابیس**:
```sql
CREATE INDEX idx_inquiry_date ON wp_posts(post_date, post_type);
CREATE INDEX idx_inquiry_status ON wp_postmeta(meta_key, meta_value);
```

---

## 🔄 به‌روزرسانی

سیستم گزارشات همراه با پلاگین اصلی به‌روزرسانی می‌شود. برای چک کردن نسخه:

```
پنل ادمین > پلاگین‌ها > Maneli Car Inquiry Core
```

---

## 📞 پشتیبانی

### مستندات
- **[راهنمای کاربر](REPORTS-GUIDE.md)**: راهنمای کامل استفاده
- **[مستندات API](REPORTS-API-DOCUMENTATION.md)**: راهنمای توسعه‌دهندگان
- **[چک‌لیست](REPORTS-CHECKLIST.md)**: وضعیت و ویژگی‌ها

### تماس
- **Email**: support@puzzlinco.com
- **Website**: https://puzzlinco.com
- **GitHub**: [مخزن پروژه](#)

---

## 🎉 تشکر

این سیستم با ❤️ توسط **ArsalanArghavan** توسعه داده شده است.

از همه کسانی که در توسعه و تست این سیستم مشارکت داشتند، سپاسگزاریم!

---

## 📄 مجوز

این پلاگین تحت مجوز **GPL v2 or later** منتشر شده است.

```
Copyright (C) 2025 ArsalanArghavan

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.
```

---

**نسخه**: 1.0.0  
**تاریخ انتشار**: 2025  
**آخرین به‌روزرسانی**: 16 اکتبر 2025

