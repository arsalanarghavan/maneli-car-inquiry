# 📊 راهنمای سیستم گزارشات پیشرفته

## نمای کلی

سیستم گزارشات پیشرفته یک ابزار جامع برای نظارت و تحلیل عملکرد سیستم استعلام خودرو است. این سیستم به مدیران و کارشناسان امکان می‌دهد تا:

- **آمار کلی** سیستم را در یک نگاه مشاهده کنند
- **عملکرد هر کارشناس** را به صورت جداگانه بررسی کنند
- **جزئیات هر استعلام** را با فیلترهای پیشرفته مشاهده کنند
- **نمودارهای تحلیلی** برای درک بهتر روندها
- **صادرات داده‌ها** به فرمت CSV برای تحلیل‌های بیشتر

## 🎯 ویژگی‌های اصلی

### 1. کارت‌های آماری (Statistics Cards)

کارت‌های آماری اطلاعات زیر را نمایش می‌دهند:

- **کل استعلام‌ها**: تعداد کل استعلام‌های ثبت شده در بازه زمانی انتخابی
- **استعلام نقدی**: تعداد استعلام‌های نقدی
- **استعلام اقساطی**: تعداد استعلام‌های اقساطی
- **تایید شده**: استعلام‌هایی که تایید شده‌اند
- **در انتظار**: استعلام‌های در حال بررسی
- **رد شده**: استعلام‌های رد شده
- **در حال پیگیری**: استعلام‌هایی که نیاز به پیگیری دارند
- **پیگیری آینده**: تعداد پیگیری‌های برنامه‌ریزی شده
- **درآمد**: مجموع درآمد از استعلام‌های تکمیل شده

### 2. فیلترهای پیشرفته

#### فیلتر بازه زمانی
- امروز
- دیروز
- هفته گذشته
- ماه گذشته
- 3 ماه گذشته
- 6 ماه گذشته
- سال گذشته
- **سفارشی**: انتخاب دستی تاریخ شروع و پایان

#### فیلتر کارشناس
امکان مشاهده آمار یک کارشناس خاص یا همه کارشناسان

### 3. تب‌های مختلف

#### تب نمای کلی (Overview)
- کارت‌های آماری
- نمودار روند روزانه استعلام‌ها
- محصولات پرطرفدار

#### تب گزارش کارشناسان (Experts Report)
جدول جامعی شامل:
- نام کارشناس
- تعداد کل استعلام‌ها
- تعداد استعلام نقدی و اقساطی
- تعداد تایید شده، رد شده، در انتظار
- تعداد کل مشتریان
- تعداد مشتریان جدید
- میزان درآمد هر کارشناس

#### تب جزئیات استعلام‌ها (Details)
- جدول تفصیلی تمام استعلام‌ها
- فیلتر بر اساس نوع (نقدی/اقساطی)
- فیلتر بر اساس وضعیت
- صفحه‌بندی برای مدیریت داده‌های زیاد
- دکمه صادرات به CSV

#### تب نمودارها (Charts)
- **نمودار دایره‌ای**: توزیع وضعیت استعلام‌ها
- **نمودار دونات**: نسبت نقدی به اقساطی
- **نمودار میله‌ای**: عملکرد ماهانه
- **نمودار مقایسه**: مقایسه عملکرد کارشناسان

### 4. نمودارها

نمودارها با استفاده از کتابخانه **Chart.js** پیاده‌سازی شده‌اند و شامل:

- **نمودار خطی**: روند روزانه استعلام‌ها (نقدی و اقساطی)
- **نمودار دایره‌ای**: توزیع وضعیت‌های مختلف
- **نمودار دونات**: نسبت نقدی به اقساطی
- **نمودار میله‌ای**: عملکرد ماهانه
- **نمودار مقایسه‌ای**: مقایسه کارشناسان

### 5. محصولات پرطرفدار

لیستی از 10 محصول برتر بر اساس تعداد استعلام شامل:
- رتبه محصول
- نام محصول
- تعداد استعلام

### 6. صادرات به CSV

امکان دانلود کامل داده‌های جدول جزئیات به فرمت CSV برای:
- تحلیل‌های پیشرفته در اکسل
- آرشیو داده‌ها
- گزارش‌دهی به مدیریت

## 🔧 نحوه استفاده

### دسترسی به گزارشات

1. وارد پنل مدیریت وردپرس شوید
2. از منوی سمت راست، بر روی **"استعلام نقدی"** کلیک کنید
3. گزینه **"📊 گزارشات"** را انتخاب کنید

### انتخاب بازه زمانی

1. از فیلتر بالای صفحه، یک بازه زمانی انتخاب کنید
2. در صورت انتخاب "سفارشی"، تاریخ شروع و پایان را مشخص کنید
3. دکمه **"اعمال فیلتر"** را بزنید

### مشاهده آمار یک کارشناس خاص

1. از فیلتر "کارشناس"، نام کارشناس مورد نظر را انتخاب کنید
2. دکمه **"اعمال فیلتر"** را بزنید
3. تمام آمارها و نمودارها برای آن کارشناس نمایش داده می‌شود

### دانلود گزارش CSV

1. به تب **"جزئیات استعلام‌ها"** بروید
2. فیلترهای مورد نظر (نوع، وضعیت) را اعمال کنید
3. دکمه **"دانلود CSV"** را بزنید
4. فایل CSV با تمام اطلاعات دانلود می‌شود

## 📈 ویجت داشبورد

یک ویجت خلاصه در داشبورد اصلی وردپرس نمایش داده می‌شود که شامل:

- آمار 30 روز گذشته
- کارت‌های سریع آماری
- لینک‌های سریع به بخش‌های مختلف

برای کارشناسان، فقط آمار خودشان نمایش داده می‌شود.

## 🎨 طراحی واکنش‌گرا

سیستم گزارشات کاملاً واکنش‌گرا است و در تمام دستگاه‌ها به خوبی کار می‌کند:

- **دسکتاپ**: نمایش کامل با همه ویژگی‌ها
- **تبلت**: سازگار با صفحه‌های متوسط
- **موبایل**: سازگار با صفحه‌های کوچک

## 🔐 سطوح دسترسی

- **مدیر سیستم**: دسترسی به همه گزارشات و آمار تمام کارشناسان
- **کارشناس**: دسترسی فقط به آمار و گزارشات خودش

## 🛠️ ساختار فنی

### فایل‌های اصلی

```
includes/
  ├── class-reports-dashboard.php          # کلاس اصلی گزارشات و کوئری‌ها
  ├── admin/
      ├── class-reports-page.php           # صفحه اصلی گزارشات
      └── class-reports-ajax-handler.php   # مدیریت درخواست‌های Ajax

assets/
  ├── css/
      └── reports-dashboard.css            # استایل‌های اختصاصی
  ├── js/
      └── admin/
          └── reports-dashboard.js         # منطق JavaScript و نمودارها
```

### متدهای اصلی کلاس `Maneli_Reports_Dashboard`

```php
// آمار کلی
get_overall_statistics($start_date, $end_date, $expert_id)

// آمار کارشناسان
get_experts_statistics($start_date, $end_date)

// آمار روزانه
get_daily_statistics($start_date, $end_date, $expert_id)

// محصولات پرطرفدار
get_popular_products($start_date, $end_date, $expert_id, $limit)

// عملکرد ماهانه
get_monthly_performance($months, $expert_id)

// جزئیات استعلام‌ها
get_inquiries_details($args)

// صادرات به CSV
export_to_csv($args)
```

### Ajax Actions

```javascript
// دریافت آمار کلی
wp_ajax_maneli_get_overall_stats

// دریافت آمار کارشناسان
wp_ajax_maneli_get_experts_stats

// دریافت آمار روزانه
wp_ajax_maneli_get_daily_stats

// دریافت محصولات پرطرفدار
wp_ajax_maneli_get_popular_products

// دریافت عملکرد ماهانه
wp_ajax_maneli_get_monthly_performance

// دریافت جزئیات استعلام‌ها
wp_ajax_maneli_get_inquiries_details

// صادرات CSV
wp_ajax_maneli_export_inquiries_csv
```

## 📊 نمونه کوئری‌های دیتابیس

سیستم از کوئری‌های بهینه شده برای عملکرد سریع استفاده می‌کند:

- استفاده از `INNER JOIN` برای کارایی بهتر
- گروه‌بندی داده‌ها در سطح دیتابیس
- کش کردن نتایج برای کاهش بار سرور
- استفاده از `wpdb->prepare()` برای امنیت

## 🚀 بهینه‌سازی‌ها

- **بارگذاری تنبل**: داده‌ها فقط در صورت نیاز بارگذاری می‌شوند
- **کش داده‌ها**: آمار پرکاربرد کش می‌شود
- **صفحه‌بندی**: داده‌های زیاد به صورت صفحه‌بندی شده نمایش داده می‌شوند
- **Ajax پویا**: بدون نیاز به رفرش صفحه

## 📞 پشتیبانی

در صورت وجود هرگونه مشکل یا پیشنهاد:
- به بخش Issues مراجعه کنید
- با تیم توسعه تماس بگیرید

## 📝 به‌روزرسانی‌های آینده

- [ ] گزارش‌های زمان‌بندی شده (Scheduled Reports)
- [ ] ارسال گزارش به ایمیل
- [ ] مقایسه بازه‌های زمانی
- [ ] نمودارهای پیشرفته‌تر
- [ ] صادرات به PDF
- [ ] فیلترهای پیشرفته‌تر
- [ ] نمایش روی نقشه جغرافیایی

---

**نسخه**: 1.0.0  
**تاریخ**: 2025  
**توسعه‌دهنده**: ArsalanArghavan

