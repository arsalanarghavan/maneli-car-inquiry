/*
 * KAMA Datepicker - A lightweight, standalone Jalali datepicker.
 * Created by Gemini for Maneli Car Inquiry.
 */
(function(){function n(t,e,i){return e||i?i?n(t,e).substring(0,e.length-i.length):t.substring(e.length):t}function l(t,e,i){var r,a;return null==e&&(e=0),null==i&&(i=t.length),r=t.substring(e,i),a=r.replace(/۰/g,"0").replace(/۱/g,"1").replace(/۲/g,"2").replace(/۳/g,"3").replace(/۴/g,"4").replace(/۵/g,"5").replace(/۶/g,"6").replace(/۷/g,"7").replace(/۸/g,"8").replace(/۹/g,"9"),parseInt(a)}function r(t){return("0"+t).slice(-2)}var a=function(){function t(t,e){this.options=e||{},this.elem=t,this.elem.setAttribute("autocomplete","off"),this.elem.addEventListener("focus",this.show.bind(this)),this.elem.addEventListener("blur",this.hide.bind(this)),this.options.bidi=this.options.bidi||!1,this.options.buttons=this.options.buttons||!1,this.options.closeButton=this.options.closeButton||!1,this.options.format=this.options.format||"YYYY/MM/DD",this.options.todayButton=this.options.todayButton||!1,this.options.placeholder=this.options.placeholder||"",this.options.gotoToday=this.options.gotoToday||!1,this.elem.setAttribute("placeholder",this.options.placeholder)}var e;return e={g_days_in_month:[31,28,31,30,31,30,31,31,30,31,30,31],j_days_in_month:[31,31,31,31,31,31,30,30,30,30,30,29]},t.prototype.show=function(t){this.create(),this.update(),this.container.style.display="block",this.position(),this.elem.value&&this.options.bidi&&this.toPersianDigits()},t.prototype.hide=function(t){var e=this;setTimeout(function(){e.container&&"none"!==e.container.style.display&&(e.container.style.display="none")},200)},t.prototype.position=function(){var t=this.elem.getBoundingClientRect();this.container.style.top=t.bottom+window.scrollY+"px",this.container.style.left=t.left+window.scrollX+"px"},t.prototype.create=function(){if(!this.container){this.container=document.createElement("div"),this.container.className="kamadatepicker-container",document.body.appendChild(this.container);var t=document.createElement("div");t.className="kamadatepicker-header",this.container.appendChild(t);var e=document.createElement("button");e.type="button",e.innerHTML="&rsaquo;",e.addEventListener("click",this.nextMonth.bind(this)),t.appendChild(e);var i=document.createElement("span");i.className="kamadatepicker-month-name",t.appendChild(i),this.monthName=i;var r=document.createElement("button");r.type="button",r.innerHTML="&lsaquo;",r.addEventListener("click",this.prevMonth.bind(this)),t.appendChild(r);var a=document.createElement("table");a.className="kamadatepicker-body",this.container.appendChild(a);var n=document.createElement("thead");a.appendChild(n);for(var l=document.createElement("tr"),s=0,h=["ش","ی","د","س","چ","پ","ج"];s<h.length;s++){var o=h[s],d=document.createElement("th");d.className="kamadatepicker-day-name",d.innerHTML=o,l.appendChild(d)}n.appendChild(l);var c=document.createElement("tbody");a.appendChild(c),this.tbody=c,this.elem.value?this.gotoDate():this.gotoToday()}},t.prototype.update=function(){for(var t=this.j_days_in_month(this.currentYear,this.currentMonth),e=this.first_day_of_month(this.currentYear,this.currentMonth),i=this.j2g(this.currentYear,this.currentMonth,1)._day,r=[],a=1;a<=e%7;a++)r.push("");for(var a=1;a<=t;a++)r.push(a);this.tbody.innerHTML="";for(var n,l=0,s=document.createElement("tr");l<r.length;){var h=r[l],o=document.createElement("td");o.className="kamadatepicker-day",h&&(-1!==(n=this.g2j(this.today.getFullYear(),this.today.getMonth()+1,this.today.getDate()))._year&&n._year===this.currentYear&&n._month===this.currentMonth&&n._day===h&&o.classList.add("today"),this.selectedDate&&this.selectedDate.year===this.currentYear&&this.selectedDate.month===this.currentMonth&&this.selectedDate.day===h&&o.classList.add("selected"),o.innerHTML=h,o.addEventListener("click",this.selectDate.bind(this,h))),s.appendChild(o),l++,l%7==0&&(this.tbody.appendChild(s),s=document.createElement("tr"))}this.tbody.appendChild(s),this.monthName.innerHTML=this.month_names[this.currentMonth-1]+" "+this.currentYear},t.prototype.selectDate=function(t){this.currentDay=t,this.selectedDate={year:this.currentYear,month:this.currentMonth,day:this.currentDay};var e=this.options.format;e=e.replace("YYYY",this.selectedDate.year),e=e.replace("MM",("0"+this.selectedDate.month).slice(-2)),e=e.replace("DD",("0"+this.selectedDate.day).slice(-2)),this.elem.value=e,this.options.bidi&&this.toPersianDigits(),this.hide()},t.prototype.gotoToday=function(){var t=new Date,e=this.g2j(t.getFullYear(),t.getMonth()+1,t.getDate());this.currentYear=e._year,this.currentMonth=e._month,this.currentDay=e._day},t.prototype.gotoDate=function(){var t=this.elem.value,e=this.options.format.indexOf("YYYY"),i=this.options.format.indexOf("MM"),r=this.options.format.indexOf("DD"),a=l(t,e,e+4),n=l(t,i,i+2),s=l(t,r,r+2);this.selectedDate={year:a,month:n,day:s},this.currentYear=a,this.currentMonth=n,this.currentDay=s},t.prototype.nextMonth=function(){12===this.currentMonth?(this.currentMonth=1,this.currentYear++):this.currentMonth++,this.update()},t.prototype.prevMonth=function(){1===this.currentMonth?(this.currentMonth=12,this.currentYear--):this.currentMonth--,this.update()},t.prototype.toPersianDigits=function(){var t,e,i,r;i=(e=(t=this.elem.value)+"").split("."),r="",i.length>1&&(r="."+i[1]),r=function(t){return(t+="").replace(/0/g,"۰").replace(/1/g,"۱").replace(/2/g,"۲").replace(/3/g,"۳").replace(/4/g,"۴").replace(/5/g,"۵").replace(/6/g,"۶").replace(/7/g,"۷").replace(/8/g,"۸").replace(/9/g,"۹")}(i[0])+r,this.elem.value=r},t.prototype.g2j=function(t,e,i){var r,a,n,l,s,h,o,d,c,p,u,g,f,m,y;for(t=parseInt(t),e=parseInt(e),i=parseInt(i),r=t-1600,a=e-1,n=i-1,l=365*r+parseInt((r+3)/4)-parseInt((r+99)/100)+parseInt((r+399)/400),h=0;h<a;++h)l+=this.g_days_in_month[h];a>1&&(r%4==0&&r%100!=0||r%400==0)&&++l,l+=n,s=l-79,c=parseInt(s/12053),s%=12053,p=979+33*c+4*parseInt(s/1461),s%=1461,s>=366&&(p+=parseInt((s-1)/365),s=(s-1)%365);for(h=0;h<11&&s>=this.j_days_in_month[h];++h)s-=this.j_days_in_month[h];return u=h+1,g=s+1,{_year:p,_month:u,_day:g}},t.prototype.j2g=function(t,e,i){var r,a,n,l,s,h,o,d,c,p,u,g;for(t=parseInt(t),e=parseInt(e),i=parseInt(i),r=t-979,a=e-1,n=i-1,l=365*r+8*parseInt(r/33)+parseInt((r%33+3)/4),h=0;h<a;++h)l+=this.j_days_in_month[h];for(l+=n,s=l+79,o=1600+400*parseInt(s/146097),s%=146097,d=!0,s>=36525&&(s--,o+=100*parseInt(s/36524),s%=36524,s>=365?s++:d=!1),o+=4*parseInt(s/1461),s%=1461,s>=366&&(d=!1,s--,o+=parseInt(s/365),s%=365),h=0;s>=this.g_days_in_month[h]+(1==h&&d);h++)s-=this.g_days_in_month[h]+(1==h&&d);return p=h+1,u=s+1,{_year:o,_month:p,_day:u}},t.prototype.j_days_in_month=function(t,e){return e<7?31:e<12?30:this.is_j_leap(t)?30:29},t.prototype.is_j_leap=function(t){return 0===(25*t+11)%33},t.prototype.first_day_of_month=function(t,e){var i=this.j2g(t,e,1);return new Date(i._year,i._month-1,i._day).getDay()},t.prototype.month_names=["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],t.prototype.day_names=["یکشنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه","شنبه"],t.prototype.today=new Date,t}();window.kamadatepicker=function(t,e){new a(document.getElementById(t),e)}})();